<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>The Best Thing About GitHub Actions Is...</title>
	
	<meta name="description" content="GitHub Actions, CircleCI, and the light they shine on the Web-deployment clusterfsck">
	
	<meta name="author" content="Jeff Dickey">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/jdickey">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/jeff_dickey">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:jdickey@seven-sigma.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/d6d968e5de074e1aeef2ed6b9cc336f9?s=35" class="img-circle" />
				Six Impossible Things Before Bundling
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="http://www.gravatar.com/avatar/d6d968e5de074e1aeef2ed6b9cc336f9?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">Six Impossible Things Before Bundling</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Software and Web developer. Tamer of deadlines. Enchanter of stakeholders.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/jdickey">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/jeff_dickey">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:jdickey@seven-sigma.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/jdickey">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>The Best Thing About GitHub Actions Is... </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   July 
	   30th,
	   
	   2019
	 </span>
	  <div class="article_body">
	  <p>The best thing about GitHub Actions is, of course, the light they shine on how badly we’ve let ourselves, as an industry, be led down the garden path to do battle with some fundamental flaws in how we’ve been taught to do deployment (and, hence, development) over the last several years.</p>

<h2 id="a-brief-history-overview">A (Brief) History Overview</h2>

<p>This year marks 30 years since the publication of what Wikipedia <a href="https://en.wikipedia.org/wiki/Continuous_integration#History">notes as</a> the <a href="https://ieeexplore.ieee.org/document/65147">“earliest known work on continuous integration”</a>, or <em>CI</em>. It took a decade or two for it to become more widespread than controversial, but the vast majority of shops that a 2019-era developer should consider submitting her CV to now practice some form of CI, and a sizeable portion of those also practice automated <a href="https://en.wikipedia.org/wiki/Continuous_delivery">continuous delivery</a>, if not fully <a href="https://en.wikipedia.org/wiki/Continuous_deployment">continuous deployment</a>. DevOps, which has been a common practice and/or a marketing buzzword for a decade now, is properly a superset of continuous deployment (CD).</p>

<p>We, as a craft industry, have a <em>disastrous</em> track record of integrating new practices into common workflows sufficiently well to see how evolving those workflows further might be impacted by the (current) capabilities and (current) limitations of tools widely used for those workflows. A prime example of this is many shops’ experience with CI/CD and <a href="https://www.docker.com/">Docker</a>.</p>

<p>When Docker first became widely popular, circa 2014-2015, most shops that had previously invested in automated CI and CD “rolled their own” scripts and tools for Docker-based testing and deployment. A number of both open-source and commercial projects were created or adapted to support Docker-based workflows, where the CI workflow built an image (usually a set of images; more on that later), run automated unit and acceptance tests against those images and, if successful, the CD workflow would deploy the image to a newly-provisioned server (usually a <a href="https://en.wikipedia.org/wiki/Virtual_private_server">VPS instance</a>) which could then be subject to further automated and/or manual testing in a <a href="https://en.wikipedia.org/wiki/Deployment_environment#Staging">staging</a> environment before being shifted into production using the CI-built image.</p>

<h2 id="whats-different-and-what-matters">What’s Different and What Matters</h2>

<p>A key point here that differentiates Docker-based workflows from many alternative CI/CD workflows is that deploying the <em>as-built-by-CI image(s)</em> at the end of a successful chain of workflows is seen as a best practice. That serves as a guarantee that the software being deployed is bit-for-bit identical to the software that successfully passed build, unit, integration, and staging tests. This is what leads to multiple reports in the literature of organisations “deploying 50 times a day” or this 2011 presentation (<a href="http://assets.en.oreilly.com/1/event/60/Velocity%20Culture%20Presentation.pdf">slides</a>, <a href="https://youtu.be/dxk8b9rSKOo">YouTube</a> discussing Amazon’s “velocity culture”; at the time, their mean time between production deployments was <em>11.6 seconds</em>, with a maximum deployment <em>per hour</em> of 1,079 hosts. (The 2019 numbers are, no doubt, considerably higher.)</p>

<p>Your startup is not going to be the next Amazon (this quarter). <em>My</em> startup is not going to be the next Amazon (this year). But stories like theirs are salutary because they show what is <em>possible</em>, whereas the number and variety of “50 deployments per day” reports show what is <em>practical</em>. And yet, as several often-critical observers have noted, “90%+ of automated CI and CD tools in production are bespoke”, implying a massive, and redundant, effort by (in practice) well-resourced and -led teams investing the staff-hours in reliable, repeatable testing and deployment. Thirty years ago, one of the favourite grey-beard horror stories of development was when the deputy junior assistant intern accidentally deployed his (usually partial) build to production, whereupon (expensive, career-limiting) <a href="https://tvtropes.org/pmwiki/pmwiki.php/Main/HilarityEnsues">hilarity ensued</a>. One point repeatedly made by many of those “50 deploys” write-ups is that <em>anybody</em> trusted to <em>write</em> code is authorised to kick off a CI/CD workflow to test and deploy that code. Possibly to staging, but often to revenue production. This can only make business sense if the process (particularly testing) is proven to be so reliable that any problem <em>not</em> caught by tests is seen primarily as a defect in the testing/deployment <em>process</em>, for which the entire team is responsible — not simply the most junior developer wondering if he’ll keep his job long enough to collect a paycheque.</p>

<h2 id="so-whats-wrong">So What’s Wrong?</h2>

<p>What’s wrong is that, in <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#decouple-applications">official Docker best practices</a>, application deployments will usually be made up of multiple containers, with each addressing a single concern (the application itself, the database/persistence layer, caching, static asset serving, HTTPS termination and reverse proxying, etc). The long-time “standard” way to orchestrate such collections of containers is through <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code"><em>Infrastructure as Code</em></a> tools like <code class="language-plaintext highlighter-rouge">docker-compose</code> or, alternatively, <a href="https://www.ansible.com/">Red Hat Ansible</a> or HashiCorp <a href="https://www.terraform.io/">Terraform</a>. Each of these tools have been used successfully in numerous “bespoke” CI/CD toolchains (their primary purpose). Getting them to work with off-the-shelf automation tools like <a href="https://docs.gitlab.com/ee/ci/">GitLab CI/CD</a> and <a href="https://github.com/features/actions">GitHub Actions</a>, to the point where they can be trusted for use by the aforementioned extremely junior developer, has proven to be “an interesting challenge”, to put it mildly.</p>

<ul>
  <li>GitHub Actions presently prohibits creation of Docker networks, which is a foundation-level requirement for Docker Compose. See <a href="https://github.com/actions/docker/issues/11#issuecomment-514608079">this GitHub issue comment</a>.</li>
  <li>Ansible has been used in earlier test-application deployments, but API changes appear to have broken the tool which it uses to deploy to our preferred hosting provider, Digital Ocean. That has been left as a fix “for the community to implement”. To Ansible’s credit, they’ve recognised the potential value of <a href="https://www.ansible.com/blog/thoughts-on-restructuring-the-ansible-project">restructuring the Ansible project</a>. That document talks a good game, and indeed makes it sound like they’ve recognised some of their more glaring challenges, but we simply haven’t had the resources to evaluate whether the show-stopper-level problems encountered with Ansible 2.6 remain in the current 2.8 (with its accumulated other API changes). The <a href="https://docs.ansible.com/ansible/latest/modules/list_of_cloud_modules.html#digital-ocean">greatly-expanded list</a> of modules for Ansible 2.8 to support Digital Ocean, and the <em>far</em> more clearly-documented <a href="https://docs.ansible.com/ansible/latest/modules/docker_compose_module.html#docker-compose-module"><code class="language-plaintext highlighter-rouge">docker_compose</code> module</a> are promising, however;</li>
  <li>Terraform looks <em>amazing</em>, and the support team have been regularly praised in the <a href="https://github.com/hashicorp/terraform/issues">GitHub Issues</a> for the project. On the other hand, there are 1,466 open issues (and 11,367 closed issues) on that repository, and this writer as yet has not yet even attempted use of the tool. That needs to change;</li>
  <li>GitLab CI/CD has been shown to work quite well for applications developed <em>from the ground up</em> to evolve within the limitations and foibles of the tool. Adapting an existing Docker Compose-orchestrated application which requires multiple containers to be active <em>in all use cases</em> has been successfully tested to the point of <em>bringing up</em> the container constellation (<code class="language-plaintext highlighter-rouge">docker-compose up -d</code>), but no testing has yet been done of any actual container/app tests or deployment beyond that. The available documentation and YouTube tutorials lead this writer to require <em>comprehensive</em> testing and configuration exploration before seriously considering it for professional* use.</li>
</ul>

<p>“Professional” in this context alludes to the context described by the <a href="https://quoteinvestigator.com/2013/08/29/get-it-right/">debatably-anonymous quote</a>; loosely,</p>

<blockquote>
  <p>An amateur practices until he gets it right. A professional practices until she can’t get it wrong.</p>
</blockquote>

<p>In our context, “can’t get it wrong” largely implies “understands the tools and their use well enough to be able to accurately predict what changes can be made successfully, what changes are certain to fail, and where further experimentation might be valuable”. That is <em>far</em> beyond “getting it right” <em>once</em> or <em>in a single configuration</em>, and seems to this writer to be a <em>minimal</em> confidence level for code intended for revenue production.</p>

<h2 id="what-works-for-you-folks">What Works for You Folks?</h2>

<p>If anybody has any experience reports (or, better yet, can point me towards good examples) of how to set up automated CI/CD for a Ruby+Postgres+Redis app using any of these tools, I’d really appreciate the help (and will be quite happy to amend this to gratefully acknowledge such assistance). I last built a CI toolchain about three years ago. The ecosystem has definitely changed, and not in a way that benefits the sole developer/small team.</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#deployment-ref">
					deployment <span>(1)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#docker-ref">
					docker <span>(1)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#docker-ref">
					docker <span>(3)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#github actions-ref">
					github actions <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#circleci-ref">
					circleci <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#continuous integration-ref">
					continuous integration <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#deployment-ref">
					deployment <span>(3)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=The Best Thing About GitHub Actions Is...&via=jeff_dickey"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/d6d968e5de074e1aeef2ed6b9cc336f9" class="img-rounded author-image" />
        <h4 class="section-title author-name">Jeff Dickey</h4>
        <p class="author-bio">Software and Web developer. Tamer of deadlines. Enchanter of stakeholders.</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/development/2019/04/13/an-interactor-or-a-use-case.html" title="An Interactor or a Use Case?">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/development/practices/2019/10/01/a-test-is-not-a-unit-test-if.html" title="A Test Is Not A Unit Test If It Does Too Much">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jdickeyghpages';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





		<footer>
			<hr/>
			<p>
				&copy; 2020 Jeff Dickey with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



